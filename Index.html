<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revisi√≥n Ambulancia - Protecci√≥n Civil</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #4a86e8;
            --secondary-color: #ff0000;
            --success-color: #d9ead3;
            --warning-color: #ffe598;
            --danger-color: #cc0000;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .app-container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }
        
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 1.4rem;
            margin-bottom: 5px;
        }
        
        .header-info {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .info-item {
            flex: 1;
            min-width: 120px;
            margin: 5px;
            padding: 8px;
            background-color: rgba(255,255,255,0.2);
            border-radius: 4px;
            display: flex;
            flex-direction: column;
        }
        
        .info-item label {
            font-size: 0.8rem;
            margin-bottom: 4px;
        }
        
        .info-item input, .info-item select {
            padding: 5px;
            border: none;
            border-radius: 3px;
            background-color: white;
        }
        
        .section {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .section-title {
            background-color: var(--primary-color);
            color: white;
            padding: 10px;
            margin: -15px -15px 15px -15px;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-actions {
            display: flex;
            gap: 5px;
        }
        
        .btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background-color 0.2s;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .item-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .item {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: var(--light-color);
        }
        
        .item-name {
            flex: 1;
            font-size: 0.95rem;
        }
        
        .item-quantity {
            width: 40px;
            text-align: center;
            font-weight: bold;
            margin: 0 10px;
        }
        
        .checkbox-container {
            position: relative;
            width: 24px;
            height: 24px;
        }
        
        .checkbox-container input {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 24px;
            width: 24px;
            background-color: white;
            border: 2px solid #ccc;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .checkbox-container input:checked ~ .checkmark {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }
        
        .checkbox-container input:checked ~ .checkmark:after {
            display: block;
        }
        
        .checkbox-container .checkmark:after {
            left: 7px;
            top: 3px;
            width: 6px;
            height: 12px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }
        
        .observations {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-top: 10px;
            resize: vertical;
            min-height: 80px;
        }
        
        .footer {
            text-align: center;
            padding: 15px;
            margin-top: 20px;
            color: #666;
            font-size: 0.9rem;
        }
        
        .tab-container {
            display: flex;
            overflow-x: auto;
            margin-bottom: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .tab {
            padding: 12px 20px;
            white-space: nowrap;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .modal-title {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .item-actions {
            display: flex;
            gap: 5px;
            margin-left: 10px;
        }
        
        .item-actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.8rem;
            color: #666;
        }
        
        .item-actions button:hover {
            color: var(--primary-color);
        }
        
        .pdf-section {
            margin-top: 20px;
            text-align: center;
        }
        
        .pdf-btn {
            padding: 10px 20px;
            font-size: 1rem;
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .pdf-btn:hover {
            background-color: #a00;
        }
        
        .pdf-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 2000;
            overflow-y: auto;
            padding: 20px;
        }
        
        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-left: 10px;
        }
        
        .status-ok {
            background-color: #28a745;
        }
        
        .status-missing {
            background-color: #dc3545;
        }
        
        .save-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .save-status.show {
            opacity: 1;
        }
        
        .progress-bar {
            height: 5px;
            background-color: #e0e0e0;
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s;
        }
        
        @media (min-width: 768px) {
            .item-list {
                grid-template-columns: 1fr 1fr;
            }
            
            .header h1 {
                font-size: 1.6rem;
            }
        }
        
        @media (min-width: 1024px) {
            .app-container {
                max-width: 1200px;
            }
            
            .item-list {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>PARTE DE REVISI√ìN AMBULANCIA SIERRA 1</h1>
            <div>PROTECCI√ìN CIVIL SAN FERNANDO DE HENARES</div>
            <div class="header-info">
                <div class="info-item">
                    <label>FECHA</label>
                    <input type="text" id="current-date" readonly>
                </div>
                <div class="info-item">
                    <label>HORA</label>
                    <input type="text" id="current-time" readonly>
                </div>
                <div class="info-item">
                    <label>TURNO</label>
                    <select id="current-shift">
                        <option value="MA√ëANA">MA√ëANA</option>
                        <option value="TARDE">TARDE</option>
                        <option value="NOCHE">NOCHE</option>
                    </select>
                </div>
                <div class="info-item">
                    <label>TES/TTS</label>
                    <input type="text" id="current-team" placeholder="Ej: V012">
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>
        
        <div class="tab-container">
            <div class="tab active" data-tab="habitacion">Habit√°culo</div>
            <div class="tab" data-tab="cabina">Cabina Asistencial</div>
            <div class="tab" data-tab="armario">Armario Enfermer√≠a</div>
            <div class="tab" data-tab="botiquin">Botiqu√≠n de Ataque</div>
            <div class="tab" data-tab="pediatrico">Botiqu√≠n Pedi√°trico/Resp.</div>
            <div class="tab" data-tab="pdf">Generar PDF</div>
        </div>
        
        <div class="tab-content active" id="habitacion-content">
            <div class="section">
                <div class="section-title">
                    <span id="habitacion-title">HABIT√ÅCULO DE CONDUCCI√ìN</span>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="openAddItemModal('habitacion')">A√±adir Elemento</button>
                        <button class="btn btn-success" onclick="editSectionTitle('habitacion')">Editar Secci√≥n</button>
                    </div>
                </div>
                <div class="item-list" id="habitacion-items">
                    <!-- Los elementos se generar√°n din√°micamente con JavaScript -->
                </div>
            </div>
            
            <!-- Secciones adicionales para Habit√°culo -->
            <div id="habitacion-additional-sections"></div>
            
            <div class="section">
                <button class="btn btn-primary" onclick="openAddSectionModal('habitacion')">A√±adir Nueva Secci√≥n</button>
            </div>
        </div>
        
        <div class="tab-content" id="cabina-content">
            <div class="section">
                <div class="section-title">
                    <span id="cabina-calienta-title">CALIENTA SUEROS</span>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="openAddItemModal('cabina-calienta')">A√±adir Elemento</button>
                        <button class="btn btn-success" onclick="editSectionTitle('cabina-calienta')">Editar Secci√≥n</button>
                    </div>
                </div>
                <div class="item-list" id="cabina-calienta-items">
                    <!-- Los elementos se generar√°n din√°micamente con JavaScript -->
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <span id="cabina-cajon1-title">CAJ√ìN 1</span>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="openAddItemModal('cabina-cajon1')">A√±adir Elemento</button>
                        <button class="btn btn-success" onclick="editSectionTitle('cabina-cajon1')">Editar Secci√≥n</button>
                    </div>
                </div>
                <div class="item-list" id="cabina-cajon1-items">
                    <!-- Los elementos se generar√°n din√°micamente con JavaScript -->
                </div>
            </div>
            
            <!-- Secciones adicionales para Cabina Asistencial -->
            <div id="cabina-additional-sections"></div>
            
            <div class="section">
                <button class="btn btn-primary" onclick="openAddSectionModal('cabina')">A√±adir Nueva Secci√≥n</button>
            </div>
        </div>
        
        <div class="tab-content" id="armario-content">
            <div class="section">
                <div class="section-title">
                    <span id="armario-title">ARMARIO ENFERMER√çA</span>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="openAddItemModal('armario')">A√±adir Elemento</button>
                        <button class="btn btn-success" onclick="editSectionTitle('armario')">Editar Secci√≥n</button>
                    </div>
                </div>
                <div class="item-list" id="armario-items">
                    <!-- Los elementos se generar√°n din√°micamente con JavaScript -->
                </div>
            </div>
            
            <!-- Secciones adicionales para Armario Enfermer√≠a -->
            <div id="armario-additional-sections"></div>
            
            <div class="section">
                <button class="btn btn-primary" onclick="openAddSectionModal('armario')">A√±adir Nueva Secci√≥n</button>
            </div>
        </div>
        
        <div class="tab-content" id="botiquin-content">
            <div class="section">
                <div class="section-title">
                    <span id="botiquin-title">BOTIQU√çN DE ATAQUE AMBULANCIA</span>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="openAddItemModal('botiquin')">A√±adir Elemento</button>
                        <button class="btn btn-success" onclick="editSectionTitle('botiquin')">Editar Secci√≥n</button>
                    </div>
                </div>
                <div class="item-list" id="botiquin-items">
                    <!-- Los elementos se generar√°n din√°micamente con JavaScript -->
                </div>
            </div>
            
            <!-- Secciones adicionales para Botiqu√≠n de Ataque -->
            <div id="botiquin-additional-sections"></div>
            
            <div class="section">
                <button class="btn btn-primary" onclick="openAddSectionModal('botiquin')">A√±adir Nueva Secci√≥n</button>
            </div>
        </div>
        
        <div class="tab-content" id="pediatrico-content">
            <div class="section">
                <div class="section-title">
                    <span id="pediatrico-title">BOTIQU√çN PEDI√ÅTRICO Y RESPIRATORIO</span>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="openAddItemModal('pediatrico')">A√±adir Elemento</button>
                        <button class="btn btn-success" onclick="editSectionTitle('pediatrico')">Editar Secci√≥n</button>
                    </div>
                </div>
                <div class="item-list" id="pediatrico-items">
                    <!-- Los elementos se generar√°n din√°micamente con JavaScript -->
                </div>
            </div>
            
            <!-- Secciones adicionales para Botiqu√≠n Pedi√°trico/Resp. -->
            <div id="pediatrico-additional-sections"></div>
            
            <div class="section">
                <button class="btn btn-primary" onclick="openAddSectionModal('pediatrico')">A√±adir Nueva Secci√≥n</button>
            </div>
        </div>
        
        <div class="tab-content" id="pdf-content">
            <div class="section">
                <div class="section-title">GENERAR INFORME PDF</div>
                <div class="pdf-section">
                    <p>Haga clic en el bot√≥n para generar un informe PDF con todos los datos de la revisi√≥n actual.</p>
                    <button class="pdf-btn" onclick="generatePDF()">Generar PDF</button>
                    <p style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                        Despu√©s de generar el PDF, puede reiniciar todos los checkmarks para la siguiente revisi√≥n.
                    </p>
                    <button class="btn btn-danger" onclick="resetAllChecks()" style="margin-top: 10px;">
                        Reiniciar Checkmarks
                    </button>
                </div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">OBSERVACIONES GENERALES</div>
            <textarea class="observations" id="general-observations" placeholder="Escriba aqu√≠ sus observaciones..."></textarea>
        </div>
        
        <div class="footer">
            REVISADO A: <span id="review-date"></span>
        </div>
    </div>

    <!-- Contenedor para PDF (se muestra temporalmente) -->
    <div class="pdf-container" id="pdf-container">
        <div id="pdf-content-all"></div>
    </div>

    <!-- Modal para a√±adir/editar elementos -->
    <div class="modal" id="item-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="item-modal-title">A√±adir Elemento</div>
                <button class="close-modal" onclick="closeItemModal()">&times;</button>
            </div>
            <div class="form-group">
                <label for="item-name">Nombre del elemento</label>
                <input type="text" id="item-name" placeholder="Ej: Guantes S">
            </div>
            <div class="form-group">
                <label for="item-quantity">Cantidad</label>
                <input type="number" id="item-quantity" min="1" value="1">
            </div>
            <div class="form-actions">
                <button class="btn btn-primary" id="save-item-btn">Guardar</button>
                <button class="btn" onclick="closeItemModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal para a√±adir secciones -->
    <div class="modal" id="section-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">A√±adir Nueva Secci√≥n</div>
                <button class="close-modal" onclick="closeSectionModal()">&times;</button>
            </div>
            <div class="form-group">
                <label for="section-name">Nombre de la secci√≥n</label>
                <input type="text" id="section-name" placeholder="Ej: Caj√≥n 2">
            </div>
            <div class="form-actions">
                <button class="btn btn-primary" id="save-section-btn">Guardar</button>
                <button class="btn" onclick="closeSectionModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal para editar t√≠tulos de secciones -->
    <div class="modal" id="edit-section-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Editar Nombre de Secci√≥n</div>
                <button class="close-modal" onclick="closeEditSectionModal()">&times;</button>
            </div>
            <div class="form-group">
                <label for="edit-section-name">Nuevo nombre de la secci√≥n</label>
                <input type="text" id="edit-section-name" placeholder="Ej: Caj√≥n 2">
            </div>
            <div class="form-actions">
                <button class="btn btn-primary" id="save-edit-section-btn">Guardar</button>
                <button class="btn" onclick="closeEditSectionModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Indicador de estado de guardado -->
    <div class="save-status" id="save-status">Datos guardados</div>

    <script>
        // Datos de ejemplo para la aplicaci√≥n
        let itemsData = {
            habitacion: [
                { id: 1, name: "Documento limpieza", quantity: 1 },
                { id: 2, name: "Gel hidroalcoh√≥lico", quantity: 1 },
                { id: 3, name: "Mascarilla Qx", quantity: 10 },
                { id: 4, name: "Mascarilla FPP2", quantity: 5 },
                { id: 5, name: "Carpeta", quantity: 1 },
                { id: 6, name: "Guantes S", quantity: 1 },
                { id: 7, name: "Guantes M", quantity: 1 },
                { id: 8, name: "Guantes L", quantity: 1 }
            ],
            "cabina-calienta": [
                { id: 1, name: "Ringer 500ml", quantity: 2 },
                { id: 2, name: "Glucosado 5% 250ml", quantity: 1 },
                { id: 3, name: "Salino 0,9% 250ml", quantity: 1 }
            ],
            "cabina-cajon1": [
                { id: 1, name: "Autoadhesivo 15x10", quantity: 1 },
                { id: 2, name: "Autoadhesivo 10x10", quantity: 1 },
                { id: 3, name: "Autoadhesivo 5x10", quantity: 1 },
                { id: 4, name: "Venda el√°stica 10x4", quantity: 1 },
                { id: 5, name: "Venda el√°stica 8x4", quantity: 1 }
            ],
            armario: [
                { id: 1, name: "Suero humidificador", quantity: 1 },
                { id: 2, name: "Vaso humidificador", quantity: 1 },
                { id: 3, name: "Salino 0,9% 500ml", quantity: 4 },
                { id: 4, name: "Fisiol√≥gico 0,9% 100ml", quantity: 4 },
                { id: 5, name: "Glucosado 5% 100ml", quantity: 1 },
                { id: 6, name: "Fisiol√≥gico 9mg 100ml", quantity: 4 },
                { id: 7, name: "Empapadores", quantity: 3 },
                { id: 8, name: "Fr√≠o qu√≠mico", quantity: 2 }
            ],
            botiquin: [
                { id: 1, name: "Fonedo", quantity: 1 },
                { id: 2, name: "Term√≥metro", quantity: 1 },
                { id: 3, name: "Pulsios√≠metro", quantity: 1 },
                { id: 4, name: "Glucometro", quantity: 1 },
                { id: 5, name: "Lancetas", quantity: 5 },
                { id: 6, name: "Tiras reactivas", quantity: 1 },
                { id: 7, name: "Az√∫car", quantity: 3 },
                { id: 8, name: "Tensi√≥metro", quantity: 1 }
            ],
            pediatrico: [
                { id: 1, name: "Mascarilla pedi√°trica", quantity: 2 },
                { id: 2, name: "Amb√∫ pedi√°trico", quantity: 1 },
                { id: 3, name: "C√°nulas orofar√≠ngeas pedi√°tricas", quantity: 3 },
                { id: 4, name: "Tubo endotraqueal pedi√°trico", quantity: 2 },
                { id: 5, name: "Estetoscopio pedi√°trico", quantity: 1 },
                { id: 6, name: "Tensi√≥metro pedi√°trico", quantity: 1 }
            ]
        };

        // T√≠tulos de secciones por defecto
        let sectionTitles = {
            habitacion: "HABIT√ÅCULO DE CONDUCCI√ìN",
            "cabina-calienta": "CALIENTA SUEROS",
            "cabina-cajon1": "CAJ√ìN 1",
            armario: "ARMARIO ENFERMER√çA",
            botiquin: "BOTIQU√çN DE ATAQUE AMBULANCIA",
            pediatrico: "BOTIQU√çN PEDI√ÅTRICO Y RESPIRATORIO"
        };

        // Variables globales
        let currentSection = '';
        let currentItemId = null;
        let currentSectionType = '';
        let dynamicSections = [];
        let currentEditingSection = '';

        // Inicializaci√≥n de la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar fecha y hora actual
            updateDateTime();
            setInterval(updateDateTime, 60000); // Actualizar cada minuto
            
            // Configurar turno y equipo (valores de ejemplo)
            document.getElementById('current-shift').value = "MA√ëANA";
            document.getElementById('current-team').value = "V012";
            
            // Generar elementos de la lista para cada secci√≥n
            renderAllItems();
            
            // Configurar funcionalidad de pesta√±as
            setupTabs();
            
            // Configurar botones de guardar
            document.getElementById('save-item-btn').addEventListener('click', saveItem);
            document.getElementById('save-section-btn').addEventListener('click', saveSection);
            document.getElementById('save-edit-section-btn').addEventListener('click', saveEditedSection);
            
            // Cargar datos guardados si existen
            loadSavedData();
            
            // Actualizar barra de progreso
            updateProgressBar();
        });

        // Funciones auxiliares
        function updateDateTime() {
            const now = new Date();
            document.getElementById('current-date').value = formatDate(now);
            document.getElementById('current-time').value = formatTime(now);
            document.getElementById('review-date').textContent = formatDate(now);
        }

        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        function formatTime(date) {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        function renderAllItems() {
            for (const section in itemsData) {
                const container = document.getElementById(`${section}-items`);
                if (container) {
                    container.innerHTML = '';
                    itemsData[section].forEach(item => {
                        const itemElement = createItemElement(item.id, item.name, item.quantity, section);
                        container.appendChild(itemElement);
                    });
                }
            }
            
            // Actualizar t√≠tulos de secciones
            updateSectionTitles();
        }

        function updateSectionTitles() {
            for (const section in sectionTitles) {
                const titleElement = document.getElementById(`${section}-title`);
                if (titleElement) {
                    titleElement.textContent = sectionTitles[section];
                }
            }
        }

        function createItemElement(id, name, quantity, section) {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item';
            itemDiv.dataset.id = id;
            
            const nameSpan = document.createElement('span');
            nameSpan.className = 'item-name';
            nameSpan.textContent = name;
            
            const quantitySpan = document.createElement('span');
            quantitySpan.className = 'item-quantity';
            quantitySpan.textContent = quantity;
            
            const checkboxContainer = document.createElement('label');
            checkboxContainer.className = 'checkbox-container';
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'item-checkbox';
            checkbox.dataset.section = section;
            checkbox.dataset.id = id;
            
            const checkmark = document.createElement('span');
            checkmark.className = 'checkmark';
            
            checkboxContainer.appendChild(checkbox);
            checkboxContainer.appendChild(checkmark);
            
            const itemActions = document.createElement('div');
            itemActions.className = 'item-actions';
            
            const editBtn = document.createElement('button');
            editBtn.innerHTML = '‚úèÔ∏è';
            editBtn.title = 'Editar';
            editBtn.addEventListener('click', () => editItem(id, section));
            
            const deleteBtn = document.createElement('button');
            deleteBtn.innerHTML = 'üóëÔ∏è';
            deleteBtn.title = 'Eliminar';
            deleteBtn.addEventListener('click', () => deleteItem(id, section));
            
            itemActions.appendChild(editBtn);
            itemActions.appendChild(deleteBtn);
            
            checkbox.addEventListener('change', function() {
                saveData();
                updateProgressBar();
            });
            
            itemDiv.appendChild(nameSpan);
            itemDiv.appendChild(quantitySpan);
            itemDiv.appendChild(checkboxContainer);
            itemDiv.appendChild(itemActions);
            
            return itemDiv;
        }

        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remover clase activa de todas las pesta√±as y contenidos
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Agregar clase activa a la pesta√±a y contenido seleccionados
                    this.classList.add('active');
                    const content = document.getElementById(`${tabId}-content`);
                    if (content) {
                        content.classList.add('active');
                    }
                });
            });
        }

        function openAddItemModal(section) {
            currentSection = section;
            currentItemId = null;
            document.getElementById('item-modal-title').textContent = 'A√±adir Elemento';
            document.getElementById('item-name').value = '';
            document.getElementById('item-quantity').value = '1';
            document.getElementById('item-modal').style.display = 'flex';
        }

        function openEditItemModal(section, id) {
            currentSection = section;
            currentItemId = id;
            const item = itemsData[section].find(item => item.id === id);
            
            if (item) {
                document.getElementById('item-modal-title').textContent = 'Editar Elemento';
                document.getElementById('item-name').value = item.name;
                document.getElementById('item-quantity').value = item.quantity;
                document.getElementById('item-modal').style.display = 'flex';
            }
        }

        function closeItemModal() {
            document.getElementById('item-modal').style.display = 'none';
        }

        function saveItem() {
            const name = document.getElementById('item-name').value.trim();
            const quantity = parseInt(document.getElementById('item-quantity').value);
            
            if (!name) {
                alert('Por favor, ingrese un nombre para el elemento.');
                return;
            }
            
            // Asegurarse de que la secci√≥n existe en itemsData
            if (!itemsData[currentSection]) {
                itemsData[currentSection] = [];
            }
            
            if (currentItemId) {
                // Editar elemento existente
                const itemIndex = itemsData[currentSection].findIndex(item => item.id === currentItemId);
                if (itemIndex !== -1) {
                    itemsData[currentSection][itemIndex].name = name;
                    itemsData[currentSection][itemIndex].quantity = quantity;
                }
            } else {
                // A√±adir nuevo elemento
                const newId = itemsData[currentSection].length > 0 
                    ? Math.max(...itemsData[currentSection].map(item => item.id)) + 1 
                    : 1;
                
                itemsData[currentSection].push({
                    id: newId,
                    name: name,
                    quantity: quantity
                });
            }
            
            // Solo renderizar los elementos de la secci√≥n actual
            const container = document.getElementById(`${currentSection}-items`);
            if (container) {
                container.innerHTML = '';
                itemsData[currentSection].forEach(item => {
                    const itemElement = createItemElement(item.id, item.name, item.quantity, currentSection);
                    container.appendChild(itemElement);
                });
            }
            
            saveData();
            closeItemModal();
        }

        function editItem(id, section) {
            openEditItemModal(section, id);
        }

        function deleteItem(id, section) {
            if (confirm('¬øEst√° seguro de que desea eliminar este elemento?')) {
                itemsData[section] = itemsData[section].filter(item => item.id !== id);
                
                // Solo renderizar los elementos de la secci√≥n actual
                const container = document.getElementById(`${section}-items`);
                if (container) {
                    container.innerHTML = '';
                    itemsData[section].forEach(item => {
                        const itemElement = createItemElement(item.id, item.name, item.quantity, section);
                        container.appendChild(itemElement);
                    });
                }
                
                saveData();
            }
        }

        function openAddSectionModal(sectionType) {
            currentSectionType = sectionType;
            document.getElementById('section-name').value = '';
            document.getElementById('section-modal').style.display = 'flex';
        }

        function closeSectionModal() {
            document.getElementById('section-modal').style.display = 'none';
        }

        function saveSection() {
            const sectionName = document.getElementById('section-name').value.trim();
            
            if (!sectionName) {
                alert('Por favor, ingrese un nombre para la secci√≥n.');
                return;
            }
            
            const sectionId = `${currentSectionType}-${sectionName.toLowerCase().replace(/\s+/g, '-')}`;
            
            // Crear la nueva secci√≥n
            const additionalSectionsContainer = document.getElementById(`${currentSectionType}-additional-sections`);
            
            const newSection = document.createElement('div');
            newSection.className = 'section';
            newSection.id = `${sectionId}-section`;
            
            newSection.innerHTML = `
                <div class="section-title">
                    <span id="${sectionId}-title">${sectionName.toUpperCase()}</span>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="openAddItemModal('${sectionId}')">A√±adir Elemento</button>
                        <button class="btn btn-success" onclick="editSectionTitle('${sectionId}')">Editar Secci√≥n</button>
                        <button class="btn btn-danger" onclick="deleteSection('${sectionId}')">Eliminar</button>
                    </div>
                </div>
                <div class="item-list" id="${sectionId}-items"></div>
            `;
            
            additionalSectionsContainer.appendChild(newSection);
            
            // Inicializar datos para la nueva secci√≥n
            itemsData[sectionId] = [];
            sectionTitles[sectionId] = sectionName.toUpperCase();
            
            // Guardar la secci√≥n din√°mica
            dynamicSections.push(sectionId);
            saveData();
            
            closeSectionModal();
        }

        function deleteSection(sectionId) {
            if (confirm('¬øEst√° seguro de que desea eliminar esta secci√≥n y todos sus elementos?')) {
                const sectionElement = document.getElementById(`${sectionId}-section`);
                if (sectionElement) {
                    sectionElement.remove();
                }
                
                delete itemsData[sectionId];
                delete sectionTitles[sectionId];
                dynamicSections = dynamicSections.filter(s => s !== sectionId);
                saveData();
            }
        }

        function editSectionTitle(sectionId) {
            currentEditingSection = sectionId;
            document.getElementById('edit-section-name').value = sectionTitles[sectionId] || '';
            document.getElementById('edit-section-modal').style.display = 'flex';
        }

        function closeEditSectionModal() {
            document.getElementById('edit-section-modal').style.display = 'none';
        }

        function saveEditedSection() {
            const newTitle = document.getElementById('edit-section-name').value.trim();
            
            if (!newTitle) {
                alert('Por favor, ingrese un nombre para la secci√≥n.');
                return;
            }
            
            // Actualizar el t√≠tulo de la secci√≥n
            sectionTitles[currentEditingSection] = newTitle.toUpperCase();
            
            // Actualizar la visualizaci√≥n
            const titleElement = document.getElementById(`${currentEditingSection}-title`);
            if (titleElement) {
                titleElement.textContent = newTitle.toUpperCase();
            }
            
            saveData();
            closeEditSectionModal();
        }

        function saveData() {
            const dataToSave = {
                itemsData: itemsData,
                sectionTitles: sectionTitles,
                dynamicSections: dynamicSections,
                shift: document.getElementById('current-shift').value,
                team: document.getElementById('current-team').value,
                observations: document.getElementById('general-observations').value,
                // Guardar estado de los checkboxes
                checkStates: getCheckStates()
            };
            
            localStorage.setItem('ambulanceCheckData', JSON.stringify(dataToSave));
            
            // Mostrar indicador de guardado
            showSaveStatus();
        }

        function getCheckStates() {
            const checkStates = {};
            const checkboxes = document.querySelectorAll('.item-checkbox');
            
            checkboxes.forEach(checkbox => {
                const section = checkbox.dataset.section;
                const itemId = checkbox.dataset.id;
                checkStates[`${section}-${itemId}`] = checkbox.checked;
            });
            
            return checkStates;
        }

        function loadSavedData() {
            const savedData = localStorage.getItem('ambulanceCheckData');
            
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                
                // Cargar datos de elementos
                if (parsedData.itemsData) {
                    itemsData = parsedData.itemsData;
                    renderAllItems();
                }
                
                // Cargar t√≠tulos de secciones
                if (parsedData.sectionTitles) {
                    sectionTitles = parsedData.sectionTitles;
                    updateSectionTitles();
                }
                
                // Cargar secciones din√°micas
                if (parsedData.dynamicSections) {
                    dynamicSections = parsedData.dynamicSections;
                    
                    // Reconstruir secciones din√°micas
                    dynamicSections.forEach(sectionId => {
                        const [sectionType, sectionName] = sectionId.split('-');
                        const additionalSectionsContainer = document.getElementById(`${sectionType}-additional-sections`);
                        
                        if (additionalSectionsContainer) {
                            const newSection = document.createElement('div');
                            newSection.className = 'section';
                            newSection.id = `${sectionId}-section`;
                            
                            newSection.innerHTML = `
                                <div class="section-title">
                                    <span id="${sectionId}-title">${sectionTitles[sectionId] || sectionName.toUpperCase()}</span>
                                    <div class="section-actions">
                                        <button class="btn btn-primary" onclick="openAddItemModal('${sectionId}')">A√±adir Elemento</button>
                                        <button class="btn btn-success" onclick="editSectionTitle('${sectionId}')">Editar Secci√≥n</button>
                                        <button class="btn btn-danger" onclick="deleteSection('${sectionId}')">Eliminar</button>
                                    </div>
                                </div>
                                <div class="item-list" id="${sectionId}-items"></div>
                            `;
                            
                            additionalSectionsContainer.appendChild(newSection);
                            
                            // Renderizar elementos de esta secci√≥n
                            const container = document.getElementById(`${sectionId}-items`);
                            if (container && itemsData[sectionId]) {
                                container.innerHTML = '';
                                itemsData[sectionId].forEach(item => {
                                    const itemElement = createItemElement(item.id, item.name, item.quantity, sectionId);
                                    container.appendChild(itemElement);
                                });
                            }
                        }
                    });
                }
                
                // Cargar datos del formulario
                if (parsedData.shift) {
                    document.getElementById('current-shift').value = parsedData.shift;
                }
                
                if (parsedData.team) {
                    document.getElementById('current-team').value = parsedData.team;
                }
                
                if (parsedData.observations) {
                    document.getElementById('general-observations').value = parsedData.observations;
                }
                
                // Cargar estados de los checkboxes
                if (parsedData.checkStates) {
                    setTimeout(() => {
                        restoreCheckStates(parsedData.checkStates);
                        updateProgressBar();
                    }, 100);
                }
            }
        }

        function restoreCheckStates(checkStates) {
            for (const key in checkStates) {
                const [section, itemId] = key.split('-');
                const checkbox = document.querySelector(`.item-checkbox[data-section="${section}"][data-id="${itemId}"]`);
                if (checkbox) {
                    checkbox.checked = checkStates[key];
                }
            }
        }

        function showSaveStatus() {
            const saveStatus = document.getElementById('save-status');
            saveStatus.classList.add('show');
            
            setTimeout(() => {
                saveStatus.classList.remove('show');
            }, 2000);
        }

        function updateProgressBar() {
            const checkboxes = document.querySelectorAll('.item-checkbox');
            const checked = document.querySelectorAll('.item-checkbox:checked');
            const progress = checkboxes.length > 0 ? (checked.length / checkboxes.length) * 100 : 0;
            
            document.getElementById('progress-fill').style.width = `${progress}%`;
        }

        function generatePDF() {
            // Mostrar mensaje de que se est√° generando el PDF
            alert('Generando PDF... Esto puede tomar unos segundos.');
            
            // Crear una versi√≥n de la aplicaci√≥n con todo el contenido visible
            const pdfContainer = document.getElementById('pdf-container');
            const pdfContent = document.getElementById('pdf-content-all');
            
            // Obtener estados actuales de los checkmarks
            const checkStates = getCheckStates();
            
            // Crear el contenido completo para el PDF
            let pdfHTML = `
                <div class="app-container">
                    <div class="header">
                        <h1>PARTE DE REVISI√ìN AMBULANCIA SIERRA 1</h1>
                        <div>PROTECCI√ìN CIVIL SAN FERNANDO DE HENARES</div>
                        <div class="header-info">
                            <div class="info-item">
                                <label>FECHA</label>
                                <div>${document.getElementById('current-date').value}</div>
                            </div>
                            <div class="info-item">
                                <label>HORA</label>
                                <div>${document.getElementById('current-time').value}</div>
                            </div>
                            <div class="info-item">
                                <label>TURNO</label>
                                <div>${document.getElementById('current-shift').value}</div>
                            </div>
                            <div class="info-item">
                                <label>TES/TTS</label>
                                <div>${document.getElementById('current-team').value}</div>
                            </div>
                        </div>
                    </div>
            `;
            
            // A√±adir todas las secciones al PDF con los estados de los checkmarks
            const allSections = Object.keys(itemsData);
            
            allSections.forEach(section => {
                const container = document.getElementById(`${section}-items`);
                if (container) {
                    // Obtener el t√≠tulo de la secci√≥n
                    const sectionTitle = sectionTitles[section] || section.toUpperCase();
                    
                    pdfHTML += `
                        <div class="section">
                            <div class="section-title">${sectionTitle}</div>
                            <div class="item-list">
                    `;
                    
                    // A√±adir cada elemento de la secci√≥n
                    itemsData[section].forEach(item => {
                        const isChecked = checkStates[`${section}-${item.id}`] || false;
                        const statusClass = isChecked ? 'status-ok' : 'status-missing';
                        const statusTitle = isChecked ? 'REVISADO ‚úì' : 'FALTA REVISAR ‚úó';
                        
                        pdfHTML += `
                            <div class="item">
                                <span class="item-name">${item.name}</span>
                                <span class="item-quantity">${item.quantity}</span>
                                <div class="status-indicator ${statusClass}" title="${statusTitle}"></div>
                            </div>
                        `;
                    });
                    
                    pdfHTML += `
                            </div>
                        </div>
                    `;
                }
            });
            
            // A√±adir observaciones
            pdfHTML += `
                <div class="section">
                    <div class="section-title">OBSERVACIONES GENERALES</div>
                    <div class="observations">${document.getElementById('general-observations').value}</div>
                </div>
                <div class="footer">
                    REVISADO A: <span>${document.getElementById('review-date').textContent}</span>
                </div>
            </div>
            `;
            
            pdfContent.innerHTML = pdfHTML;
            pdfContainer.style.display = 'block';
            
            // Capturar el contenido y generar el PDF
            setTimeout(() => {
                html2canvas(pdfContent, {
                    scale: 2,
                    useCORS: true,
                    logging: false
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const imgWidth = 210; // A4 width in mm
                    const pageHeight = 295; // A4 height in mm
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;

                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;

                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }

                    // Obtener fecha y hora para el nombre del archivo
                    const now = new Date();
                    const dateStr = formatDate(now).replace(/\//g, '-');
                    const timeStr = formatTime(now).replace(/:/g, '-');
                    
                    pdf.save(`Revision_Ambulancia_${dateStr}_${timeStr}.pdf`);
                    
                    // Ocultar el contenedor del PDF
                    pdfContainer.style.display = 'none';
                    
                    // Mostrar mensaje de confirmaci√≥n
                    alert('PDF generado correctamente. Puede reiniciar los checkmarks para la siguiente revisi√≥n.');
                });
            }, 500);
        }

        function resetAllChecks() {
            if (confirm('¬øEst√° seguro de que desea reiniciar todos los checkmarks? Esto borrar√° todas las marcas actuales.')) {
                const checkboxes = document.querySelectorAll('.item-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // Limpiar observaciones
                document.getElementById('general-observations').value = '';
                
                saveData();
                updateProgressBar();
                alert('Todos los checkmarks han sido reiniciados. La aplicaci√≥n est√° lista para una nueva revisi√≥n.');
            }
        }

        // Guardar datos cuando cambien los campos
        document.getElementById('current-shift').addEventListener('change', saveData);
        document.getElementById('current-team').addEventListener('input', saveData);
        document.getElementById('general-observations').addEventListener('input', saveData);
    </script>
</body>
</html>